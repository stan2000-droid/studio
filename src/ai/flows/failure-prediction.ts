// This is an autogenerated file from Firebase Studio.
'use server';
/**
 * @fileOverview Predicts future failure probability of mining components based on sensor data.
 *
 * - predictFailure - A function that predicts the failure probability of mining components.
 * - PredictFailureInput - The input type for the predictFailure function.
 * - PredictFailureOutput - The return type for the predictFailure function.
 */

import {ai} from '@/ai/genkit';
import {z} from 'genkit';

const PredictFailureInputSchema = z.object({
  componentType: z.enum(['WindingRope', 'Sheave', 'Drum']).describe('The type of mining component.'),
  temperature: z.number().describe('The temperature of the component in degrees Celsius.'),
  corrosion: z.number().describe('The corrosion level of the component on a scale of 1 to 10, where 10 is the most corroded.'),
  diameterReduction: z.number().describe('The diameter reduction of the component in millimeters.'),
  strength: z.number().describe('The strength of the component in MPa.'),
  historicalData: z.string().optional().describe('Historical sensor data for the component, if available.'),
});

export type PredictFailureInput = z.infer<typeof PredictFailureInputSchema>;

const PredictFailureOutputSchema = z.object({
  failureProbability: z
    .number()
    .min(0)
    .max(1)
    .describe(
      'The predicted probability of failure for the component, ranging from 0 (no failure) to 1 (certain failure).'
    ),
  reasoning: z.string().describe('The reasoning behind the failure probability prediction.'),
  recommendations: z.string().describe('Recommendations for maintenance based on the prediction.'),
});

export type PredictFailureOutput = z.infer<typeof PredictFailureOutputSchema>;

export async function predictFailure(input: PredictFailureInput): Promise<PredictFailureOutput> {
  return predictFailureFlow(input);
}

const prompt = ai.definePrompt({
  name: 'predictFailurePrompt',
  input: {schema: PredictFailureInputSchema},
  output: {schema: PredictFailureOutputSchema},
  prompt: `You are an AI expert in predicting the failure of mining equipment, including winding ropes, sheaves, and drums used in mine hoisting systems.

  Given the following sensor data for a specific component, predict the probability of failure within the next month and provide reasoning and recommendations.

  Component Type: {{{componentType}}}
  Temperature: {{{temperature}}} Â°C
  Corrosion: {{{corrosion}}} (scale of 1 to 10)
  Diameter Reduction: {{{diameterReduction}}} mm
  Strength: {{{strength}}} MPa
  Historical Data: {{{historicalData}}}

  Consider the interdependencies between these factors. For example, high temperature and corrosion may significantly reduce the strength of the component, increasing the likelihood of failure.

  Reasoning should clearly articulate how you arrived at the failure probability.  Recommendations should be specific and actionable, focusing on condition-based maintenance to prevent potential failures.

  Ensure that the failureProbability field is a number between 0 and 1.
`,
});

const predictFailureFlow = ai.defineFlow(
  {
    name: 'predictFailureFlow',
    inputSchema: PredictFailureInputSchema,
    outputSchema: PredictFailureOutputSchema,
  },
  async input => {
    const {output} = await prompt(input);
    return output!;
  }
);
